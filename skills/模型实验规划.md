# 模型实验规划与评估方案 (v6.0 - Counterfactual & Sampling Update)

**版本**: v6.0
**日期**: 2026-01-13
**状态**: 解释框架升级完毕，采样策略优化中。

---

## 1. 实验设计 (Experimental Design)

### 1.1 双重配置对照 (Dual Configuration)
*   **Dynamic (Main)**: 包含 `dNDVI`, `dNBR` 等差分特征。
*   **Static (Control)**: 仅包含火前背景特征。
*   **目的**: 通过对比两组实验的 GNNExplainer 结果（特别是 DSI 指标），证明动态因子的激活作用。

### 1.2 采样策略 (Sampling Strategy)
通过 `metadata/*.yaml` 中的 `sampling` 字段控制，支持两种模式：
*   **Block Split (Default)**:
    *   按 SU_ID 排序，前 40% 为测试集，后 60% 为训练集。
    *   **优点**: 空间完全隔离，防止自相关泄露。
*   **Random Balanced (New)**:
    *   正样本 7:3 随机划分。
    *   负样本在训练集中进行 1:1 欠采样（优先选择 InSAR 稳定区），在测试集中全量保留。
    *   **优点**: 解决类别不平衡，提升 Recall。

---

## 2. 评估体系 (Evaluation Metrics)

### 2.1 预测性能
*   **Global Metrics**: ROC-AUC, PR-AUC, F1-Score (在全量测试集上计算)。
*   **Stability Check**: 利用 InSAR 数据验证高风险区的真实形变情况。

### 2.2 解释性能 (Interpretation Metrics)
*   **Feature Mask**: 核心特征的权重分布。
*   **CPD (Counterfactual Probability Drop)**: 动态因子移除后的概率下降值（绝对贡献）。
*   **DSI (Dynamic Sensitivity Index)**: 动态特征 mask 占比（相对敏感度）。

---

## 3. 执行流程 (Pipeline)

1.  **Data Processing (Phase 0-1)**:
    *   运行 `run_data_pipeline_dynamic.bat`。
    *   **特征提取**: 仅计算 Mean/Mode，生成 18 维特征向量。
    *   **数据构建**: 根据配置文件生成 `tabular_dataset.parquet`。

2.  **Model Training (Phase 6.1)**:
    *   运行 `train_landslide.py`。
    *   加载 `tabular_dataset.parquet`，根据 `sampling` 策略动态划分 Train/Test。
    *   训练 `GcnEncoderNode`，保存最佳权重。

3.  **Explanation (Phase 6.3)**:
    *   运行 `explain_landslide.py` (参数: `--num-explain 50 --num-epochs 50 --num-runs 1`)。
    *   **Target**: 仅解释测试集中的 TP 节点。
    *   **Output**: 生成 `explanation_summary.csv` 和详细 Artifacts。

4.  **Correction & Mapping (Phase 6.4)**:
    *   运行 `insar_correction.py`。
    *   生成最终的易发性地图。

---

## 4. 可视化计划
*   **Map**: 绘制“致灾模式分区图” (Dynamic-Triggered vs Static-Dominant)。
*   **Scatter**: 绘制 Slope vs DSI 散点图，揭示火灾敏感度随坡度的非线性变化。
*   **Boxplot**: 对比 Dynamic/Static 配置下的特征重要性分布。
