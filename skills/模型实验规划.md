# 模型实验规划与评估方案 (v5.1 - Verified Static Bias)

**版本**: v5.1
**日期**: 2026-01-05
**状态**: 基准测试已完成，验证了静态偏差假设 (Static Bias Confirmed)。

---

## 1. 核心假设验证结果

**H0 (静态偏差) 验证结果**: 
通过运行 `train_xgb.py` 进行归因分析，已证实：
*   **静态特征贡献 (Static Importance)**: **71.27%**
*   **动态特征贡献 (Dynamic Importance)**: **28.73%**
*   **结论**: 传统模型在火后环境中确实过度依赖坡度、岩性等静态因子，导致其对火烧迹地内的环境突变响应迟钝。这为 CXGNN 的必要性提供了数据支撑。

---

## 2. 实验设计 (Experimental Design)

### 2.1 统一基准对照组 (Unified Baselines)
所有模型统一使用 `ml_utils.py` 进行评估，确保 ROC/PR 指标具有可比性：
*   **RF (Random Forest)**: AUC ~ 0.80。作为集成学习的非线性基准。
*   **SVM (Support Vector Machine)**: AUC ~ 0.60。作为线性基准，评估特征的线性可分性。
*   **XGBoost**: AUC ~ 0.75。用于静态偏差的定量分析。
*   **GCN (Graph Convolutional Network)**: **[Base Model]** 作为被解释的基础模型。
*   **GNNExplainer (Ours)**: 核心分析工具，用于揭示 GCN 预测背后的动态机理。

### 2.2 评估维度 (Evaluation Metrics)

*   **指标一致性**: 所有模型输出 `su_id, label, prob, split` 格式的 CSV。
*   **空间一致性**: 所有模型生成 10m 分辨率的 GeoTIFF (LSM)。
*   **解释一致性**: 
    *   **Feature Mask**: 对比 GNNExplainer 的特征掩码与 XGBoost 的 Feature Importance，验证动态因子的重要性。
    *   **Edge Mask**: 识别高风险节点的关键邻居，验证空间依赖性。

### 2.3 双重实验验证 (Dual Experiment)
为了严谨证明动态因子的有效性，将进行两组完全独立的实验：
1.  **Dynamic Experiment (Main)**: 使用 `dNDVI`, `dNBR` 等差分指数。预期 GNNExplainer 将赋予动态特征高权重。
2.  **Static Experiment (Control)**: 使用火前/火后静态指数，**不包含**差分特征。预期 GNNExplainer 将主要关注地形特征。

---

## 3. 执行流程 (Unified Pipeline)

### Phase 0: 统一数据准备
*   **Dynamic**: 运行 `run_all_experiments.bat` (默认使用 dynamic config)。
*   **Static**: 运行 `run_all_experiments_static.bat` (使用 static config)。

### Phase 1: 基准训练与归因
1.  运行 RF, SVM, XGBoost。
2.  运行 GCN (`experiments/02_dl_gcn/train_gcn.py`)，作为后续解释的基础。

### Phase 2: GNNExplainer 机理揭示
1.  **加载模型**: 加载 Phase 1 训练好的最优 GCN 模型。
2.  **解释实例**: 选择典型的 TP (True Positive) 和 FN (False Negative) 节点。
3.  **运行解释**: 运行 `experiments/GNNExplainer/explain_main.py` (基于 GNNExplainer)。
4.  **可视化**: 生成特征掩码热力图和解释子图。

### Phase 3: InSAR 物理校正与最终制图
1.  **加载 InSAR 数据**: 读取 `InSAR_desc_2024_2025`。
2.  **分级与融合**:
    *   定义形变阈值（如 > -10mm/yr 为稳定，< -10mm/yr 为形变）。
    *   **Correction Logic**: $Final\_Risk = \max(Model\_Risk, InSAR\_Risk)$。即，如果 InSAR 显示显著形变，直接定为高风险；否则保留模型预测。
    *   **注意**: InSAR 数据**仅**在此步骤使用，**不参与** Phase 1/2 的模型训练。
3.  **制图**: 生成最终的《融合物理约束的滑坡易发性图》。

---

## 4. 下一步具体行动
1.  编写 `experiments/GNNExplainer/explain_main.py` 适配脚本。
2.  编写 `experiments/GNNExplainer/insar_correction.py` 校正脚本。
3.  运行解释实验，提取 Dynamic vs Static 的 Mask 差异。
4.  生成最终的《雅江火后滑坡动态增量风险图》及《致灾机理图》。